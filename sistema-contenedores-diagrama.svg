<svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <!-- Definiciones de estilos y gradientes (reutilizadas) -->
  <defs>
    <style>
      .component-box { fill: #ffffff; stroke: #2c3e50; stroke-width: 2; }
      .container-box { fill: #f4f6f7; stroke: #7f8c8d; stroke-width: 2; stroke-dasharray: 8,4; }
      .process-box { fill: #ffffff; stroke: #95a5a6; stroke-width: 1.5; }
      .tcp-arrow { stroke: #e74c3c; stroke-width: 2; fill: none; marker-end: url(#arrowred); }
      .ipc-arrow { stroke: #27ae60; stroke-width: 2; fill: none; marker-end: url(#arrowgreen); stroke-dasharray: 5,5; }
      .redis-arrow { stroke: #9b59b6; stroke-width: 2; fill: none; marker-end: url(#arrowpurple); }
      .text-title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #2c3e50; }
      .text-small { font-family: Arial, sans-serif; font-size: 11px; fill: #34495e; }
      .text-label { font-family: Arial, sans-serif; font-size: 10px; fill: #7f8c8d; }
      .container-label { font-family: Arial, sans-serif; font-size: 12px; font-weight: bold; fill: #5d6d7e; }
    </style>
    <marker id="arrowred" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#e74c3c" /></marker>
    <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#27ae60" /></marker>
    <marker id="arrowpurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="#9b59b6" /></marker>
  </defs>
  
  <!-- Título -->
  <text x="600" y="30" text-anchor="middle" style="font-size: 18px; font-weight: bold; fill: #2c3e50;">
    Diagrama de Despliegue Físico (Contenedores Docker)
  </text>
  
  <!-- Cliente CLI (Fuera de Docker) -->
  <rect x="50" y="70" width="160" height="90" class="component-box" rx="5" style="fill:#e8f8f5;"/>
  <text x="130" y="95" text-anchor="middle" class="text-title">Host Machine</text>
  <text x="130" y="115" text-anchor="middle" class="text-small">Cliente CLI</text>
  <text x="130" y="130" text-anchor="middle" class="text-label">(submit_job.py)</text>
  
  <!-- Red Docker -->
  <rect x="250" y="70" width="900" height="680" class="container-box" rx="10" style="fill:#fdf2e9; opacity:0.4;"/>
  <text x="700" y="95" text-anchor="middle" class="container-label" style="font-size: 16px;">Docker Network (genome-network)</text>
  
  <!-- Contenedor Master -->
  <rect x="280" y="120" width="180" height="120" class="container-box" rx="5"/>
  <text x="370" y="140" text-anchor="middle" class="container-label">Contenedor: Master</text>
  <rect x="300" y="160" width="140" height="60" class="process-box" rx="3"/>
  <text x="370" y="180" text-anchor="middle" class="text-title">Servidor Master</text>
  <text x="370" y="195" text-anchor="middle" class="text-small">master_server.py</text>
  
  <!-- Contenedor Collector -->
  <rect x="500" y="120" width="180" height="120" class="container-box" rx="5"/>
  <text x="590" y="140" text-anchor="middle" class="container-label">Contenedor: Collector</text>
  <rect x="520" y="160" width="140" height="60" class="process-box" rx="3"/>
  <text x="590" y="180" text-anchor="middle" class="text-title">Servidor Collector</text>
  <text x="590" y="195" text-anchor="middle" class="text-small">collector_server.py</text>
  
  <!-- Contenedor Redis -->
  <rect x="720" y="120" width="180" height="120" class="container-box" rx="5"/>
  <text x="810" y="140" text-anchor="middle" class="container-label">Contenedor: Redis</text>
  <rect x="740" y="160" width="140" height="60" class="process-box" rx="3" style="fill: #ffe0e0;"/>
  <text x="810" y="185" text-anchor="middle" class="text-title">Redis Server</text>
  
  <!-- Contenedores Worker (1, 2, 3) -->
  <g id="worker-container-1">
    <rect x="280" y="280" width="280" height="180" class="container-box" rx="5"/>
    <text x="420" y="300" text-anchor="middle" class="container-label">Contenedor: Worker 1</text>
    <!-- Proceso Celery Worker -->
    <rect x="300" y="320" width="110" height="120" class="process-box" rx="3"/>
    <text x="355" y="340" text-anchor="middle" class="text-title">Celery Worker</text>
    <text x="355" y="355" text-anchor="middle" class="text-label">(Procesa chunks)</text>
    <!-- Proceso Agente Monitor -->
    <rect x="430" y="320" width="110" height="120" class="process-box" rx="3"/>
    <text x="485" y="340" text-anchor="middle" class="text-title">Agente Monitor</text>
    <text x="485" y="355" text-anchor="middle" class="text-label">(Lee métricas)</text>
    <!-- Flecha IPC interna -->
    <path d="M 410 380 L 430 380" class="ipc-arrow"/>
    <text x="420" y="400" text-anchor="middle" class="text-label" style="fill: #27ae60;">Unix Socket</text>
  </g>
  
  <g id="worker-container-2">
    <rect x="580" y="280" width="280" height="180" class="container-box" rx="5"/>
    <text x="720" y="300" text-anchor="middle" class="container-label">Contenedor: Worker 2</text>
    <rect x="600" y="320" width="110" height="120" class="process-box" rx="3"/>
    <text x="655" y="340" text-anchor="middle" class="text-title">Celery Worker</text>
    <text x="655" y="355" text-anchor="middle" class="text-label">(Procesa chunks)</text>
    <rect x="730" y="320" width="110" height="120" class="process-box" rx="3"/>
    <text x="785" y="340" text-anchor="middle" class="text-title">Agente Monitor</text>
    <text x="785" y="355" text-anchor="middle" class="text-label">(Lee métricas)</text>
    <path d="M 710 380 L 730 380" class="ipc-arrow"/>
    <text x="720" y="400" text-anchor="middle" class="text-label" style="fill: #27ae60;">Unix Socket</text>
  </g>
  
  <g id="worker-container-3">
    <rect x="880" y="280" width="280" height="180" class="container-box" rx="5"/>
    <text x="1020" y="300" text-anchor="middle" class="container-label">Contenedor: Worker 3</text>
    <rect x="900" y="320" width="110" height="120" class="process-box" rx="3"/>
    <text x="955" y="340" text-anchor="middle" class="text-title">Celery Worker</text>
    <text x="955" y="355" text-anchor="middle" class="text-label">(Procesa chunks)</text>
    <rect x="1030" y="320" width="110" height="120" class="process-box" rx="3"/>
    <text x="1085" y="340" text-anchor="middle" class="text-title">Agente Monitor</text>
    <text x="1085" y="355" text-anchor="middle" class="text-label">(Lee métricas)</text>
    <path d="M 1010 380 L 1030 380" class="ipc-arrow"/>
    <text x="1020" y="400" text-anchor="middle" class="text-label" style="fill: #27ae60;">Unix Socket</text>
  </g>
  
  <!-- Conexiones de Red -->
  <!-- Cliente -> Master -->
  <path d="M 210 130 L 280 190" class="tcp-arrow"/>
  <text x="220" y="155" class="text-label">TCP (Job)</text>
  
  <!-- Master -> Redis -->
  <path d="M 460 180 Q 590 100 720 180" class="redis-arrow"/>
  <text x="590" y="130" text-anchor="middle" class="text-label">Encola Tareas</text>

  <!-- Redis -> Workers -->
  <path d="M 810 240 L 810 260 L 355 260 L 355 320" class="redis-arrow"/>
  <path d="M 810 240 L 810 260 L 655 260 L 655 320" class="redis-arrow"/>
  <path d="M 810 240 L 810 260 L 955 260 L 955 320" class="redis-arrow"/>
  <text x="500" y="255" class="text-label">Consume Tareas</text>

  <!-- Workers -> Redis -->
  <path d="M 355 440 L 355 470 L 810 470 L 810 240" class="redis-arrow" stroke-dasharray="5,5"/>
  <path d="M 655 440 L 655 470 L 810 470 L 810 240" class="redis-arrow" stroke-dasharray="5,5"/>
  <path d="M 955 440 L 955 470 L 810 470 L 810 240" class="redis-arrow" stroke-dasharray="5,5"/>
  <text x="500" y="485" class="text-label">Guarda Resultados</text>

  <!-- Agentes -> Collector -->
  <path d="M 485 320 L 485 265 L 590 265 L 590 240" class="tcp-arrow"/>
  <path d="M 785 320 L 785 265 L 590 265 L 590 240" class="tcp-arrow"/>
  <path d="M 1085 320 L 1085 265 L 590 265 L 590 240" class="tcp-arrow"/>
  <text x="780" y="255" class="text-label">Reporte de Métricas (TCP)</text>
  
  <!-- Collector -> Master -->
  <path d="M 500 180 L 460 180" class="tcp-arrow" stroke-dasharray="8,4"/>
  <text x="480" y="170" class="text-label">Alertas</text>

  <!-- Leyenda de Flechas -->
  <g id="leyenda-flechas">
    <line x1="300" y1="550" x2="380" y2="550" class="tcp-arrow"/>
    <text x="400" y="555" class="text-small"><tspan font-weight="bold">TCP Socket:</tspan> Comunicación entre contenedores.</text>
    
    <line x1="300" y1="580" x2="380" y2="580" class="ipc-arrow"/>
    <text x="400" y="585" class="text-small"><tspan font-weight="bold">Unix Socket (IPC):</tspan> Comunicación local dentro de un mismo contenedor.</text>
    
    <line x1="300" y1="610" x2="380" y2="610" class="redis-arrow"/>
    <text x="400" y="615" class="text-small"><tspan font-weight="bold">Redis/Celery:</tspan> Cola de tareas y persistencia de resultados.</text>
  </g>
</svg>
